<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kiwi English Exams</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Bootstrap (optional if already added) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- intl-tel-input CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css" />

    <!-- intl-tel-input JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>


    <!-- Bootstrap CSS (if not already included) -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Country Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/country-select-js@2.0.1/build/css/countrySelect.min.css">

    <!-- jQuery (required for country-select) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Country Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/country-select-js@2.0.1/build/js/countrySelect.min.js"></script>


    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap 5 JS and Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>

    <script>
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');

        if (!token || role !== 'superadmin') {
            window.location.href = '/login.html'; // redirect to login or 403 page
        }
    </script>

    <!-- Navbar Start -->
    <div class="container-fluid p-0">
        <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5 fixed-top">
            <a href="/" class="navbar-brand ml-lg-3">
                <h1 class="m-0 text-uppercase text-primary"><i class="fa fa-book-reader mr-3"></i>Kiwi English Exams
                </h1>
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between px-lg-3" id="navbarCollapse">
                <div class="navbar-nav mx-auto py-0">

                    <!-- <a href="superadmin-dashboard.html" class="nav-item nav-link">SuperAdmin Dashboard</a> -->
                    <a href="country-directors-list.html" class="nav-item nav-link active">Country Directors</a>
                    <a href="superadmin-profile.html" class="nav-item nav-link">Profile</a>
                </div>
                <a href="#" onclick="logout()" class="btn btn-primary py-2 px-4 d-none d-lg-block">Logout</a>
            </div>
        </nav>
    </div>
    <!-- Navbar End -->

    <!-- Admin Dashboard Start -->
    <div class="container">
        <section class="mt-5" id="users">
            <h2 class="mb-3 text-primary"><i class="fa fa-users me-2"></i>Country Directors</h2>
            <p>Manage and view the details of all Country Directors below.</p>

            <!-- Add New Country Director Button -->
            <a class="btn btn-primary mb-3" href="add-country-director.html">Add New Country Director</a>

            <!-- Country Director Table -->
            <div class="table-responsive bg-white p-3 rounded shadow-sm">
                <h3 class="text-primary mb-3">Country Director List</h3>
                <table id="countryDirectorsTable" class="table table-striped table-bordered align-middle">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be injected here -->
                    </tbody>
                </table>

                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-white">
                                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body" id="deleteModalBody">
                                <!-- Dynamic content will be injected here -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>
        <!-- <div class="row">
                <div class="col-md-12">
                    


                    

                </div>
            </div> -->
    </div>
    <!-- Admin Dashboard End -->

    <!-- Footer Start -->
    <div class="container-fluid position-relative overlay-top bg-dark text-white-50 py-5" style="margin-top: 90px;">
        <div class="container">
          <div class="row">
            <!-- Brand & Description -->
            <div class="col-md-12 mt-5">
              <a href="index.html" class="navbar-brand">
                <h1 class="mt-n2 text-uppercase text-white">
                  <i class="fa fa-book-reader me-2"></i> Kiwi English Exams
                </h1>
              </a>
              <p class="m-0 text-justify mt-1">
                At Kiwi English Exams, we are your trusted partner in mastering English proficiency tests across
                New Zealand and beyond. Whether you're preparing for academic, professional, or immigration
                purposes, our expert guidance, proven strategies, and personalized support will help you achieve
                the results you need. Join thousands of successful learners who have reached their goals with
                confidence and clarity.
              </p>
            </div>
          </div>
    
          <div class="row">
            <!-- Contact Info -->
            <div class="col-md-8 mt-4">
              <h3 class="text-white">Get In Touch</h3>
              <p><i class="fa fa-map-marker-alt me-2"></i>123 Lambton Quay, Wellington Central, Wellington 6011,
                New Zealand</p>
              <p><i class="fa fa-phone-alt me-2"></i>+64 21 987 6543</p>
              <p><i class="fa fa-envelope me-2"></i>info@kiwienglishexams.nz</p>
            </div>
    
            <!-- Social Media -->
            <div class="col-md-4 mt-4 text-justify">
              <!-- First Row: Heading -->
              <div class="mb-3">
                <h3 class="text-white mb-0">Follow Us</h3>
              </div>
    
              <!-- Second Row: Icons -->
              <div class="d-flex flex-row justify-content-start">
                <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-twitter"></i></a>
                <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-facebook-f"></i></a>
                <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-linkedin-in"></i></a>
                <a class="text-white" href="#"><i class="fab fa-2x fa-instagram"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    
      <div class="container-fluid bg-dark text-white-50 border-top py-4"
        style="border-color: rgba(256, 256, 256, .1) !important;">
        <div class="container">
          <div class="row">
            <div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
              <p class="m-0">Copyright &copy; <a class="text-white" href="#">kiwiexams.netlify.app</a>. All Rights
                Reserved.
              </p>
            </div>
          </div>
        </div>
      </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary rounded-0 btn-lg-square back-to-top"><i
            class="fa fa-angle-double-up"></i></a>

    <script>
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('role');
            window.location.href = '/login.html'; // change this path if needed
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tableBody = document.querySelector('#countryDirectorsTable tbody');

            const loadData = async () => {
                try {
                    const response = await fetch('https://b-end-test.netlify.app/.netlify/functions/get-countrydirectors');
                    if (!response.ok) throw new Error(`Server returned ${response.status}`);

                    const directors = await response.json();
                    if (!Array.isArray(directors)) throw new Error('Invalid data format received');

                    tableBody.innerHTML = directors.map(director => `
                        <tr>
                            <td>${director.country || 'N/A'}</td>
                            <td>${director.countrydirector_name || 'N/A'}</td>
                            <td>${director.countrydirector_email || 'N/A'}</td>
                            <td>${director.phone || 'N/A'}</td>
                            <td>
                            <a href="edit-country-director.html?id=${director._id}" class="btn btn-success btn-sm me-1">Edit</a>
                            <!-- Delete Button -->
                            <button 
                                class="btn btn-danger btn-sm me-1"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal"
                                data-id="${director._id}"
                                data-name="${director.countrydirector_name}">
                                Delete
                            </button>
                            </td>
                        </tr>
                        `)
                        .join('');

                } catch (error) {
                    console.error('Error:', error);
                    tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">Error loading data</td></tr>`;
                }
            };

            loadData();
        });
    </script>

    <script>
        let deleteId = null;
        let deleteModalInstance = null;

        document.addEventListener('DOMContentLoaded', function () {
            const deleteModal = document.getElementById('deleteModal');

            // Initialize and store Bootstrap modal instance
            deleteModalInstance = new bootstrap.Modal(deleteModal);

            // Listen for modal show event to set ID and name
            deleteModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;

                // Get data attributes
                deleteId = button.getAttribute('data-id');
                const name = button.getAttribute('data-name');

                // Set modal body content
                const modalBody = deleteModal.querySelector('#deleteModalBody');
                modalBody.innerHTML = `Are you sure you want to delete <b>${name}</b>?`;
            });
        });

        function confirmDelete() {
            if (!deleteId) return;

            fetch(`https://b-end-test.netlify.app/.netlify/functions/delete-countrydirector?id=${deleteId}`, {
                method: 'DELETE',
            })
                .then(res => res.json())
                .then(data => {
                    try {
                        if (data.message) {
                            // Hide modal if instance is valid
                            if (deleteModalInstance) deleteModalInstance.hide();
                            window.location.reload();
                        } else {
                            alert('Delete failed: ' + (data.error || 'Unknown error'));
                        }
                    } catch (err) {
                        console.error('❌ Modal close error:', err);
                        alert('Data deleted, but modal closing failed.');
                        window.location.reload();
                    }
                })
                .catch(err => {
                    console.error('❌ Delete error:', err);
                    alert('Network error while deleting.');
                });
        }
    </script>




    <!-- JavaScript Libraries -->

    <!-- <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>



</body>

</html>