<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kiwi English Exams</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.min.css" />
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script> -->


    <!-- Bootstrap (optional if already added) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- intl-tel-input CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css" />

    <!-- intl-tel-input JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>


    <!-- Bootstrap CSS (if not already included) -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Country Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/country-select-js@2.0.1/build/css/countrySelect.min.css">

    <!-- jQuery (required for country-select) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Country Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/country-select-js@2.0.1/build/js/countrySelect.min.js"></script>


    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap 5 JS and Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>

    <script>
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');

        if (!token || role !== 'student') {
            window.location.href = 'login.html';
        }
    </script>

    <!-- Navbar Start -->
    <div class="container-fluid p-0">
        <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5 fixed-top">
            <a href="index.html" class="navbar-brand ml-lg-3">
                <h1 class="m-0 text-uppercase text-primary"><i class="fa fa-book-reader mr-3"></i>Kiwi English Exams
                </h1>
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between px-lg-3" id="navbarCollapse">
                <div class="navbar-nav mx-auto py-0">

                    <!-- <a href="student-dashboard.html" class="nav-item nav-link">Student Dashboard</a> -->
                    <a href="register-for-exam.html" class="nav-item nav-link">Register for Exam</a>
                    <a href="student-profile.html" class="nav-item nav-link active">Profile</a>
                </div>
                <a href="#" onclick="logout()" class="btn btn-primary py-2 px-4 d-none d-lg-block">Logout</a>
            </div>
        </nav>
    </div>
    <!-- Navbar End -->

    <!-- Student Dashboard Start -->
    <div class="container">
        <div class="row">
            <!-- Main Content -->
            <div class="col-md-12">

                <section id="profile" class="mt-5">
                    <h2 class="text-primary mb-4"><i class="fa fa-user mr-2"></i> Profile</h2>
                    <p>Manage and update your personal profile details below. You can change your name, email
                        address, password, and other account information.</p>

                    <div class="bg-white p-4 rounded shadow-sm mb-4">
                        <h4 class="mb-3 text-primary">Edit Profile</h4>
                        <form>
                            <input type="hidden" id="student_id" required>
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="student_name" placeholder="Enter Full name">
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="student_email"
                                    placeholder="Enter Email Address">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control border-0 border-bottom" id="student_phone_no"
                                    placeholder="Phone Number" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">New Password</label>
                                <input type="password" class="form-control" id="student_password"
                                    placeholder="Enter new password">
                            </div>
                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="student_password_confirmation"
                                    placeholder="Re-enter new password">
                            </div>
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </form>

                    </div>
                </section>

            </div>
        </div>
    </div>
    <!-- Student Dashboard End -->

    <!-- Footer Start -->
    <div class="container-fluid position-relative overlay-top bg-dark text-white-50 py-5" style="margin-top: 90px;">
        <div class="container">
            <div class="row">
                <!-- Brand & Description -->
                <div class="col-md-12 mt-5">
                    <a href="index.html" class="navbar-brand">
                        <h1 class="mt-n2 text-uppercase text-white">
                            <i class="fa fa-book-reader me-2"></i> Kiwi English Exams
                        </h1>
                    </a>
                    <p class="m-0 text-justify mt-1">
                        At Kiwi English Exams, we are your trusted partner in mastering English proficiency tests across
                        New Zealand and beyond. Whether you're preparing for academic, professional, or immigration
                        purposes, our expert guidance, proven strategies, and personalized support will help you achieve
                        the results you need. Join thousands of successful learners who have reached their goals with
                        confidence and clarity.
                    </p>
                </div>
            </div>

            <div class="row">
                <!-- Contact Info -->
                <div class="col-md-8 mt-4">
                    <h3 class="text-white">Get In Touch</h3>
                    <p><i class="fa fa-map-marker-alt me-2"></i>123 Lambton Quay, Wellington Central, Wellington 6011,
                        New Zealand</p>
                    <p><i class="fa fa-phone-alt me-2"></i>+64 21 987 6543</p>
                    <p><i class="fa fa-envelope me-2"></i>info@kiwienglishexams.nz</p>
                </div>

                <!-- Social Media -->
                <div class="col-md-4 mt-4 text-justify">
                    <!-- First Row: Heading -->
                    <div class="mb-3">
                        <h3 class="text-white mb-0">Follow Us</h3>
                    </div>

                    <!-- Second Row: Icons -->
                    <div class="d-flex flex-row justify-content-start">
                        <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-twitter"></i></a>
                        <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-facebook-f"></i></a>
                        <a class="text-white mr-4" href="#"><i class="fab fa-2x fa-linkedin-in"></i></a>
                        <a class="text-white" href="#"><i class="fab fa-2x fa-instagram"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid bg-dark text-white-50 border-top py-4"
        style="border-color: rgba(256, 256, 256, .1) !important;">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
                    <p class="m-0">Copyright &copy; <a class="text-white" href="#">kiwiexams.netlify.app</a>. All Rights
                        Reserved.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary rounded-0 btn-lg-square back-to-top"><i
            class="fa fa-angle-double-up"></i></a>

    <script>
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('role');
            window.location.href = '/login.html'; // change this path if needed
        }
    </script>

    <script>
        const phoneInput = document.querySelector("#student_phone_no");
        const iti = window.intlTelInput(phoneInput, {
            initialCountry: "auto",
            separateDialCode: true,
            nationalMode: true,
            geoIpLookup: function (success, failure) {
                fetch("https://ipapi.co/json")
                    .then((res) => res.json())
                    .then((data) => success(data.country_code))
                    .catch(() => success("us"));
            },
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js",
        });
    </script>

    <script>
        const userId = localStorage.getItem('userId');
        const userToken = localStorage.getItem('token');
        // alert(userToken);
        fetch(`https://b-end-test.netlify.app/.netlify/functions/get-student-profile?id=${userId}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${userToken}`,  // ✅ Authorization header is REQUIRED
            }
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! Status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                if (data && data.student_email) {
                    document.getElementById('student_id').value = data.student_id;
                    document.getElementById('student_name').value = data.student_name;
                    document.getElementById('student_email').value = data.student_email;
                    document.getElementById('student_phone_no').value = data.student_phone_no;
                }
            })
            .catch(err => {
                alert('Fetch error: ' + err.message);
                console.error('Fetch error:', err);
            });
    </script>

    <script>
        const form = document.querySelector('form');
        
        const messageBox = document.getElementById('messageBox');

        function showMessage(message, type = 'success') {
            messageBox.className = `alert alert-${type}`;
            messageBox.textContent = message;
            messageBox.classList.remove('d-none');
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('student_id').value;
            const name = document.getElementById('student_name').value;
            const email = document.getElementById('student_email').value;
            const phone = document.getElementById('student_phone_no').value;
            const password = document.getElementById('student_password').value;
            const password_confirmation = document.getElementById('student_password_confirmation').value;
            const token = localStorage.getItem('token');

            // alert(phone);

            if (password !== password_confirmation) {
                showMessage('Passwords do not match!', 'danger');
                return;
            }

            try {
                const response = await fetch(`https://b-end-test.netlify.app/.netlify/functions/update-student-profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        id,
                        student_name: name,
                        student_email: email,
                        student_password: password,
                        student_phone_no: phone
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // alert('Profile updated successfully!');
                    showMessage('Profile updated successfully!', 'success');
                    window.location.reload();
                } else {
                    showMessage(`Error: ${data.error}`, 'danger');
                }
            } catch (error) {
                console.error('Update failed:', error);
                showMessage('Something went wrong. Please try again.', 'danger');
            }
        });
    </script>

    <!-- JavaScript Libraries -->
    <!-- <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
</body>

</html>